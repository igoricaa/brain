{% load static %}
{% load django_vite %}

<!DOCTYPE html>

<html>
    <head>
        {# Ensure React plugin preamble flag exists before any modules load in dev #}
        <script type="module">window.__vite_plugin_react_preamble_installed__ = true;</script>
        {% block google_analytics %}
            {% if GOOGLE_ANALYTICS_ID %}
                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', '{{ GOOGLE_ANALYTICS_ID }}');
                </script>
            {% endif %}
        {% endblock google_analytics %}

        <title>{% block full_head_title %}{% block head_title %}{{ page_title }}{% endblock %} â€¢ {{ SITE_NAME }}{% endblock %}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="{% static 'favicon.ico' %}" rel="icon" type="image/x-icon" />

        {# Vite will inject CSS for entries in production via manifest; in dev, HMR handles styles #}

        {% block extra_head %}{% endblock %}

        {% if GOOGLE_SITE_VERIFICATION %}
            <meta name="google-site-verification" content="{{ GOOGLE_SITE_VERIFICATION }}" />
        {% endif %}
    </head>

    <body id="{% block body_id %}{% endblock %}" class="{% block body_class %}min-h-dvh bg-slate-50 text-gray-900 antialiased{% endblock %}">

        {% block body %}
            {% block content %}{% endblock %}
        {% endblock body %}

        {% block js %}
            {# React preamble flag set in <head>; now include HMR and entry #}
            {% vite_hmr_client %}
            {% vite_asset 'src/main.tsx' %}
        {% endblock %}
        {% block extra_js %}{% endblock %}
    </body>
</html>
