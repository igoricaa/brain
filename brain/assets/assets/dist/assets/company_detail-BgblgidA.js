import{c as y,j as t,r as u}from"./client-DrRGiZqB.js";function v(e,n,r){return[r,n,e].filter(Boolean).join(", ")}function N(e){const[n,r]=u.useState(null),[s,a]=u.useState(!!e),[o,l]=u.useState(null);return u.useEffect(()=>{let c=!1;async function f(){if(e){a(!0),l(null);try{const d=await fetch(`/api/companies/companies/${e}/`,{credentials:"same-origin",headers:{Accept:"application/json"}});if(!d.ok)throw new Error(`HTTP ${d.status}`);const m=await d.json();c||r(m)}catch(d){const m=d instanceof Error?d.message:"Failed to load company";c||l(m)}finally{c||a(!1)}}}return f(),()=>{c=!0}},[e]),{data:n,loading:s,error:o}}function _({company:e}){const n=u.useMemo(()=>v(e.hq_country,e.hq_state_name,e.hq_city_name),[e.hq_country,e.hq_state_name,e.hq_city_name]);return t.jsxs("div",{className:"card mt-3",children:[t.jsx("div",{className:"card-header",children:"About"}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"Website:"})," ",e.website?t.jsx("a",{href:e.website,target:"_blank",rel:"noreferrer",children:e.website}):t.jsx("span",{children:"-"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"HQ:"})," ",t.jsx("span",{children:n||"-"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"Founded:"})," ",t.jsx("span",{children:e.year_founded??"-"})]}),e.summary&&t.jsxs("div",{className:"mb-0",children:[t.jsx("strong",{children:"Summary:"}),t.jsx("div",{children:e.summary})]})]})]})}function S(){const[e,n]=u.useState(()=>new URLSearchParams(window.location.search));return u.useEffect(()=>{const s=()=>n(new URLSearchParams(window.location.search));return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),{params:e,update:s=>{const a=new URLSearchParams(e.toString());s(a);const o=a.toString(),l=o?`${window.location.pathname}?${o}`:window.location.pathname;window.history.replaceState({},"",l),n(a)}}}function g(e){const n=new URLSearchParams(window.location.search);for(const[s,a]of Object.entries(e))a===null?n.delete(s):n.set(s,a);const r=n.toString();return r?`${window.location.pathname}?${r}`:window.location.pathname}function L(e,n,r,s){const[a,o]=u.useState({}),[l,c]=u.useState(!!e),[f,d]=u.useState(null);return u.useEffect(()=>{let m=!1;async function p(){if(e){c(!0),d(null);try{const h=new URLSearchParams;h.set("company",e),h.set("page",String(n)),h.set("page_size",String(r)),s&&h.set("source",s);const i=await fetch(`/api/library/files/?${h.toString()}`,{credentials:"same-origin",headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const x=await i.json(),j=Array.isArray(x)?{count:x.length,results:x}:x;m||o(j)}catch(h){const i=h instanceof Error?h.message:"Failed to load documents";m||d(i)}finally{m||c(!1)}}}return p(),()=>{m=!0}},[e,n,r,s]),{data:a,loading:l,error:f}}function E(){const[e,n]=u.useState([]);return u.useEffect(()=>{let r=!1;async function s(){try{const a=await fetch("/api/library/sources/",{credentials:"same-origin",headers:{Accept:"application/json"}});if(!a.ok)return;const o=await a.json(),l=Array.isArray(o)?o:o.results||[];r||n(l)}catch{}}return s(),()=>{r=!0}},[]),e}function w(e){if(e.src_url)return e.src_url;if(e.file)try{const r=new URL(e.file,window.location.origin).pathname.split("/");return r[r.length-1]||e.file}catch{return e.file}return e.uuid}function A({uuid:e}){const{params:n}=S(),r=n.get("l_all"),s=parseInt(n.get("l_page")||"1",10),a=r?100:parseInt(n.get("l_size")||"5",10),o=n.get("l_source"),{data:l,loading:c,error:f}=L(e,s,a,o),d=E(),m=l.previous?g({l_page:String(s-1)}):null,p=l.next?g({l_page:String(s+1)}):null,h=g({l_all:"1",l_size:null,l_page:null});return t.jsxs("div",{className:"card mt-3",children:[t.jsxs("div",{className:"card-header d-flex align-items-center justify-content-between",children:[t.jsx("span",{children:"Library Documents"}),t.jsx("span",{className:"small",children:t.jsx("a",{className:"text-decoration-none",href:h,children:"View all"})})]}),t.jsxs("div",{className:"card-body",children:[t.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[t.jsx("label",{className:"small text-muted",children:"Source"}),t.jsxs("select",{className:"form-select form-select-sm w-auto",value:o||"",onChange:i=>{const x=i.target.value||null,j=g({l_source:x,l_page:"1"});window.location.href=j},children:[t.jsx("option",{value:"",children:"All"}),d.map(i=>t.jsx("option",{value:i.uuid,children:i.name},i.uuid))]})]}),c&&t.jsx("div",{className:"text-muted small",children:"Loading…"}),f&&t.jsx("div",{className:"text-danger small",children:f}),!c&&!f&&t.jsxs(t.Fragment,{children:[t.jsx("ul",{className:"mb-2",children:l.results&&l.results.length?l.results.map(i=>t.jsxs("li",{children:[i.file||i.src_url?t.jsx("a",{href:i.file||i.src_url,target:"_blank",rel:"noreferrer",children:w(i)}):t.jsx("span",{children:w(i)}),i.source?.name?t.jsx("span",{className:"text-muted small ms-2",children:i.source.name}):null]},i.uuid)):t.jsx("span",{className:"text-secondary",children:"No documents found."})}),typeof l.count=="number"&&l.results&&l.results.length?t.jsxs("div",{className:"d-flex align-items-center justify-content-end gap-2 small",children:[t.jsxs("span",{className:"text-muted",children:["Showing ",(s-1)*a+1,"–",(s-1)*a+l.results.length," of ",l.count]}),t.jsxs("div",{className:"btn-group btn-group-sm",role:"group",children:[m?t.jsx("a",{className:"btn btn-outline-secondary",href:m,children:"Prev"}):t.jsx("span",{className:"btn btn-outline-secondary disabled",children:"Prev"}),p?t.jsx("a",{className:"btn btn-outline-secondary",href:p,children:"Next"}):t.jsx("span",{className:"btn btn-outline-secondary disabled",children:"Next"})]})]}):null]})]})]})}function P(){const e=document.getElementById("company-about-root");if(!e)return;const n=e.getAttribute("data-uuid");if(!n)return;const r=y.createRoot(e);function s({uuid:a}){const{data:o,loading:l,error:c}=N(a);return l?t.jsx("div",{className:"text-muted small",children:"Loading…"}):c?t.jsx("div",{className:"text-danger small",children:c}):o?t.jsx(_,{company:o}):null}r.render(t.jsx(s,{uuid:n}))}function k(){const e=document.getElementById("company-library-root");if(!e)return;const n=e.getAttribute("data-uuid");if(!n)return;y.createRoot(e).render(t.jsx(A,{uuid:n}))}function b(){P(),k()}function q(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b()}export{q as initialize};
